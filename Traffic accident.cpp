#include <unsupported/Eigen/MatrixFunctions>
#include <cstdio>
#include <iostream>
#include <iomanip>
#include <cmath>
#include <complex>
#include <cstdlib>
#include <cstdio>
#include<ctime>
#include <vector>
#include <math.h>
#include <stdlib.h>
#include <fstream>
#include <windows.h>
#include <sql.h>
#include <sqlext.h>
#include <sqltypes.h>
#include<time.h>


using namespace Eigen;
using namespace std;

int main(){

	ofstream oFile;

    oFile.open("市區道路交通事故延續時間預測.csv", ios::out | ios::trunc);


//--------------------------------參數項(X矩陣)----------------------------------------//

//-------------------------行為參數項種類; 列為不同筆參數-----------------------------//
MatrixXd X(255,22);
X<<
48.76,	0.8,	9,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	3,
46.21,	1.44,	12,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	2,	3,
29.77,	1.02,	8,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
45.84,	1.5,	10,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	2,	2,
48.1,	1.1,	24,	0,	1,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
30.56,	0.77,	15,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
35.61,	0.77,	3,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	1,	2,
30.33,	0.77,	15,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
42.69,	0.74,	7,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	1,	2,
42.18,	0.87,	8,	1,	1,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	2,
40.77,	1,	6,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	2,	2,
33.1,	0.77,	25,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	1,	3,
29.7,	0.74,	13,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	2,	3,
27.48,	0.75,	21,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	1,	3,
50.56,	0.87,	8,	0,	1,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
45.55,	1.5,	14,	1,	1,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	2,	2,
48.38,	0.7,	8,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	1,	1,
18.68,	0.74,	20,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	2,	3,
25.89,	0.57,	41,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	2,	2,
28.45,	0.57,	24,	0,	1,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	1,	1,
55.85,	1.39,	11,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	1,	2,
47.58,	0.58,	4,	0,	1,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	3,	3,
48.92,	1.02,	13,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	2,	2,
31.41,	0.77,	28,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	2,	3,
27.59,	0.57,	10,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	4,	2,
34.43,	0.74,	2,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	2,	3,
44.25,	0.74,	10,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
21.53,	0.42,	24,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
46.4,	1.15,	9,	0,	1,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
47.15,	1.5,	15,	0,	1,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	2,	2,
27,	1.39,	9,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	1,	2,
47.51,	0.74,	10,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
46.09,	1.49,	5,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	2,	2,
42.01,	1.49,	19,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	1,	3,
46.41,	7.28,	13,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
23.71,	0.52,	13,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	2,	2,
44.12,	0.77,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	1,	2,
48.22,	0.68,	15,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	2,	2,
29.27,	0.77,	6,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	2,	2,
45.28,	0.74,	17,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	2,	2,
31.86,	0.77,	17,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	2,	1,
41.88,	1.02,	10,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	2,	4,
28.96,	0.77,	5,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	3,	2,
36.94,	0.58,	20,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
43.31,	1.5,	7,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
46.13,	1.15,	6,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	3,
46.22,	1.14,	10,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
44.2,	1.02,	5,	0,	1,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	2,	2,
29.77,	0.85,	19,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
41.36,	1.24,	9,	0,	1,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
30.61,	0.77,	18,	0,	1,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
42.14,	1.02,	6,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	3,
36.46,	0.77,	7,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	4,
28.56,	0.74,	23,	1,	1,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	1,	2,
38.28,	0.74,	17,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
47.27,	0.74,	11,	1,	1,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	2,	3,
33.35,	0.55,	26,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
30.63,	0.77,	20,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	2,	2,
47.16,	1.15,	3,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	1,	2,
26.89,	0.77,	21,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
42.95,	0.74,	6,	0,	1,	1,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
44.64,	1.5,	3,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	2,	2,
45.05,	0.74,	14,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	2,	2,
30.17,	0.61,	33,	0,	1,	1,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	3,
38.57,	0.62,	33,	0,	1,	1,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	3,
44.06,	1.14,	14,	0,	1,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	2,	2,
29.94,	0.77,	6,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
33.43,	0.77,	25,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
32.55,	0.74,	17,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
39.66,	0.47,	12,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
47.22,	1.08,	30,	0,	1,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	3,	1,
34.08,	0.77,	17,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
42.67,	1.39,	9,	1,	1,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	2,	3,
45.86,	1,	6,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	2,	2,
48.47,	1.39,	12,	1,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
26.34,	0.46,	6,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	2,	2,
25.68,	0.74,	13,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	4,	2,
43.72,	1.15,	11,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	3,
49.19,	0.74,	19,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
38.33,	0.74,	6,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	2,	2,
43.51,	1.02,	22,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	1,	2,
31.36,	0.8,	9,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
46.99,	0.74,	9,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
47.08,	0.74,	5,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
27.56,	0.9,	7,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
27.56,	0.77,	16,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
29.15,	0.77,	8,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	2,	3,
49.19,	0.74,	5,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
31.03,	0.77,	15,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	1,	2,
44.38,	1.21,	16,	1,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
40.95,	0.74,	22,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	2,	1,
31.9,	0.77,	36,	1,	1,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
27.87,	0.57,	29,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
28.59,	0.75,	7,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	3,
45.24,	0.74,	5,	0,	1,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
44.99,	0.58,	13,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	2,	3,
47.21,	1.06,	11,	0,	1,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	2,	3,
45.99,	0.74,	5,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
38.43,	0.61,	5,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	3,
30.5,	0.77,	18,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
28.81,	0.42,	18,	1,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
44.87,	1.15,	10,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	1,	2,
42.92,	0.48,	8,	1,	1,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	2,	4,
29.39,	0.77,	8,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	2,	2,
43.38,	1.4,	17,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	3,
28.43,	0.77,	14,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	2,	2,
30.1,	0.7,	9,	0,	1,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
38.06,	0.77,	2,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	2,	2,
15.93,	0.43,	9,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
46.35,	1.14,	14,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
30.42,	0.77,	14,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
34.6,	0.74,	24,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
37.75,	1.02,	16,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	1,	3,
25.89,	0.77,	17,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
34.57,	0.74,	12,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	3,	3,
41.23,	1,	24,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	1,	2,
48.81,	0.74,	4,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	1,	2,
27.28,	0.77,	16,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
33.17,	0.57,	7,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
31.77,	0.99,	14,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
30.48,	0.77,	3,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
42.39,	0.74,	16,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
34.49,	0.77,	6,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	2,
37.24,	0.87,	5,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	2,	2,
27.45,	0.74,	21,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
37.99,	1,	3,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
16.94,	0.74,	4,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	2,	2,
24.05,	0.77,	14,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	1,	2,
38.63,	1.5,	14,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	1,	2,
36.15,	0.74,	7,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
30.28,	0.77,	8,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
38.81,	0.43,	4,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	2,	2,
39.83,	1.02,	11,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	1,	2,
30.9,	0.77,	4,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	3,	2,
41.01,	0.74,	5,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
42.13,	1.02,	11,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
46.18,	1.5,	15,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	1,	2,
39.42,	0.74,	15,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
37.41,	0.74,	12,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	1,	2,
43.23,	1.02,	4,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	2,	2,
39.21,	0.74,	12,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	1,	2,
44.07,	1.5,	14,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
42.5,	1.02,	16,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
30.5,	0.77,	10,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
22.25,	0.77,	4,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
47.2,	1.14,	18,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,	2,
27.23,	0.77,	17,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
31.62,	0.43,	23,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	2,
39.81,	0.74,	6,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
41.62,	1.14,	2,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	2,	2,
42.92,	1,	5,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
35.85,	0.43,	13,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
23.58,	0.77,	13,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
35.31,	0.74,	13,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
43.21,	1.02,	13,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
33.28,	0.77,	12,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	2,	2,
28.15,	0.77,	4,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
41.59,	1.02,	13,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	3,
41.23,	1.5,	2,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
30.74,	0.77,	22,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
26.79,	0.43,	27,	0,	1,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
32.56,	0.77,	15,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	2,	2,
30.64,	0.74,	24,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
36.25,	0.43,	7,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	2,	2,
24.2,	0.77,	20,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	2,	2,
32.11,	0.77,	13,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	2,	2,
43.84,	1.02,	8,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	2,	3,
26.37,	0.74,	12,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
30.95,	0.43,	38,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
42.29,	1.14,	8,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
28.46,	0.43,	15,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	3,
41.43,	1.38,	10,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,
34.63,	0.43,	6,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	1,
31.25,	0.77,	13,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
29.46,	0.57,	26,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
19.8,	0.43,	8,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	3,	2,
31.15,	0.43,	38,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	3,
33.47,	0.77,	14,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
29.53,	0.57,	9,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
27.99,	0.77,	18,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	1,	2,
32.57,	0.57,	10,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	1,	2,
28.45,	0.77,	7,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	2,
39.81,	0.74,	2,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	2,	2,
32.32,	0.57,	4,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	1,
39.28,	1.38,	7,	0,	1,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
40.44,	1.02,	9,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	1,
33.33,	0.43,	5,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	2,	2,
34.98,	0.43,	12,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	2,
29.88,	0.57,	8,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
44.41,	0.74,	2,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
31.56,	0.77,	14,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
42.51,	0.74,	19,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	1,	2,
23.44,	0.77,	21,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	1,	2,
27.1,	1.5,	13,	1,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	3,
38.74,	1.14,	4,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
30.74,	0.77,	8,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	3,	1,
28.83,	0.74,	3,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
28.98,	1.14,	37,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
23.97,	0.84,	10,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
34.24,	1,	31,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
37.96,	1.02,	16,	0,	1,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	1,
29.86,	0.77,	26,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
28.34,	0.77,	15,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
34.7,	0.74,	29,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	3,	3,
37.37,	1.02,	25,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
27.84,	0.74,	16,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
31.1,	0.57,	24,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
33.83,	0.74,	13,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
34.19,	0.77,	28,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
25.61,	0.43,	21,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
32.51,	0.77,	16,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	1,
40.08,	1.38,	25,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	1,	2,
30.01,	0.43,	16,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
29.74,	0.43,	22,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	2,	2,
40.21,	1,	23,	0,	1,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	2,
23.64,	0.57,	21,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
26.79,	0.74,	26,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	1,	2,
23.73,	0.74,	11,	0,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	2,	2,
29.18,	0.77,	16,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
30.34,	0.77,	10,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	1,	1,
36.44,	1.02,	5,	1,	1,	1,	0,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	1,
27.91,	0.77,	9,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
19.67,	0.43,	30,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	1,
30.22,	0.77,	4,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	1,	2,
20.46,	0.77,	36,	1,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	1,	2,
30.96,	0.57,	15,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	2,	2,
31.15,	0.77,	15,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
31.03,	0.77,	23,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
40.13,	1,	26,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	2,	2,
35.75,	0.74,	28,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	1,	2,
45.89,	1.02,	14,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	1,	2,
32.02,	0.77,	3,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
18.68,	0.43,	24,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	1,	2,
23.05,	0.77,	4,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	2,	2,
44.15,	1.5,	16,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
24.7,	0.43,	40,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	2,	2,
30.89,	0.77,	9,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	1,	2,
45.65,	1,	30,	0,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	2,	2,
47.68,	1.38,	17,	0,	1,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	3,	2,
28.98,	0.43,	12,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	1,
39.74,	1,	25,	1,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	2,	2,
28.76,	0.77,	25,	1,	1,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	1,	2,
31.88,	0.74,	28,	0,	1,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2,
34.95,	0.43,	9,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	2,	2,
36.83,	0.74,	16,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
36.83,	0.74,	30,	0,	1,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	1,	0,	0,	1,	2,
23.76,	0.57,	37,	0,	1,	0,	1,	0,	0,	0,	0,	0,	0,	0,	0,	1,	0,	1,	0,	0,	1,	2,
30.28,	0.77,	7,	0,	1,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
35.79,	0.43,	27,	0,	1,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	1,	2,
44.82,	1.02,	8,	1,	1,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	2,	2,
32.89,	0.77,	4,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	1,	2,
28.87,	0.43,	26,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	2,	2,
45,	1.14,	16,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	2,	2,
40.77,	0.74,	22,	0,	0,	0,	0,	1,	0,	0,	0,	0,	0,	0,	0,	1,	0,	0,	1,	0,	2,	2,
35.53,	0.57,	8,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	0,	0,	1,	0,	0,	1,	2;



int mm=X.row(0).size();  //組間數量
int nn=X.col(0).size(); // 回歸數量
MatrixXd Theta_1(mm,1);             //解析回歸係數解
MatrixXd Theta_2 (mm,1);            //梯度下降回歸係數解

srand( time(NULL) );

double S1;
double S2;

double PROD_Multi;
double Cossim;

double R_square;
double SST;
double SSE;
double SSR;
double Y_Nor_avg;
//-------------------梯度下降迴歸係數初始化; 範圍設定[-1,1]---------------------------//

for(int j=0;j<Theta_2.row(0).size();++j){

for(int i=0;i<Theta_2.col(0).size();++i){

Theta_2 (i,j)=(double) rand() /(RAND_MAX+1 );
}

}

//------------------------------------------------------------------------------------//

double  f;
double  F;
//------------------------------------------------------------------------------------//

MatrixXd X_avg(1,mm);    // 每一項參數平均值
MatrixXd u(1,mm);        // 每一項參數最大值與最小值差
MatrixXd X_Nor(nn,mm);    // 輸入X矩陣正規化結果

//------------------------------自變數X矩陣正規化----------------------------------------//
for(int i=0;i<X.row(0).size();++i){
 X_avg(0,i)=(X.col(i)).sum()/X.col(0).size();
 u(0,i)=X.col(i).maxCoeff()-X.col(i).minCoeff();

}

for(int i=0;i<X.col(0).size();++i){
for(int j=0;j<X.row(0).size();++j){

X_Nor(i,j)=(X(i,j)-X_avg(0,j))/u(0,j);
X_Nor(i,0)=1;

}
}
//cout<<u<<endl;
//cout<<X_Nor<<endl;
//------------------------------------------------------------------------------------//
//----------------------------延遲時間正規化(單位:s)----------------------------------//
MatrixXd Y(nn,1);
Y<<
10,
11,
17,
12,
5,
10,
7,
10,
18,
10,
9,
14,
10,
9,
8,
12,
12,
8,
11,
13,
8,
5,
10,
12,
15,
9,
8,
32,
6,
9,
34,
9,
10,
9,
12,
10,
10,
12,
16,
16,
13,
10,
10,
9,
10,
10,
12,
7,
10,
7,
10,
14,
14,
7,
10,
6,
11,
13,
13,
7,
6,
10,
6,
4,
8,
5,
12,
11,
7,
6,
10,
6,
7,
7,
10,
35,
48,
7,
7,
20,
6,
8,
8,
16,
8,
8,
13,
10,
18,
10,
7,
7,
7,
8,
11,
4,
10,
14,
8,
12,
8,
10,
17,
7,
12,
9,
11,
13,
20,
11,
11,
6,
22,
18,
8,
11,
11,
11,
5,
13,
5,
8,
9,
9,
33,
11,
13,
14,
5,
18,
9,
11,
7,
8,
7,
13,
9,
7,
6,
12,
10,
9,
12,
7,
19,
10,
12,
12,
15,
12,
16,
12,
11,
7,
16,
11,
12,
13,
8,
10,
12,
15,
11,
9,
17,
13,
7,
22,
10,
20,
13,
16,
7,
10,
15,
37,
9,
9,
9,
26,
10,
8,
10,
20,
12,
19,
10,
7,
19,
24,
8,
9,
9,
15,
10,
20,
11,
12,
13,
9,
9,
8,
7,
13,
11,
12,
12,
13,
14,
14,
18,
11,
9,
8,
8,
14,
18,
10,
12,
11,
17,
10,
27,
11,
16,
8,
12,
10,
7,
7,
9,
12,
6,
22,
10,
10,
13,
12,
11,
9,
12,
13,
9,
9,
8,
8,
13,
9,
11,
7,
7,
8,
5,
19,
10;


MatrixXd Y_avg(nn,1);
MatrixXd Y_Nor(nn,1);

for(int i=0;i<Y.col(0).size();++i){
for(int j=0;j<Y.row(0).size();++j){

Y_avg(i,j)=Y.sum()/Y.size();

Y_Nor(i,j)=(Y(i,j)-Y_avg(0,j))/(Y.maxCoeff()-Y.minCoeff());


}
}
//------------------------------------------------------------------------------------//
//----------------------------------回歸解析解----------------------------------------//

Theta_1=(X_Nor.transpose()*X_Nor).inverse()*X_Nor.transpose()*Y_Nor;


//----------------------------------梯度下降法計算-------------------------------------//
MatrixXd J_Th(1,1);
MatrixXd MSE(1,1);
 
//double s=pow(2*(X.row(0)).size(),-1);
MatrixXd Grad_J(nn,1);
double Lr=0.1;                 // 學習率
double ep=60000;               //疊代數
MatrixXd J_Th_Lambda(1,1);
double apha=0.1;
double J[60000];
MatrixXd PROD(1,1);           //
MatrixXd Y_R(nn,1);
MatrixXd Y_Inv_nor(nn,1);
MatrixXd  MAPE(nn,1);
MatrixXd  MAPE_ratio(nn,1);
double MAPE_sum;
//---------------------------------------"疊代開始"----------------------------------------------------------// 
  for(int k=0;k<ep;++k)

    {

//J_Th= pow(2*(X_Nor.col(0)).size(),-1)*(((X_Nor*Theta_2).array() )-(Y_Nor.array()) ).square();

J_Th= pow(2*(X_Nor.col(0)).size(),-1)*((X_Nor*Theta_2-Y_Nor ).transpose()) *(X_Nor*Theta_2-Y_Nor) + apha*pow(2*(X_Nor.col(0)).size(),-1)*Theta_2.transpose() * Theta_2 ;
//J_Th= pow(2*(X_Nor.col(0)).size(),-1)*((X_Nor*Theta_2-Y_Nor ).transpose()) *(X_Nor*Theta_2-Y_Nor) + apha*Theta_2.transpose() * Theta_2 ;
MSE= pow(2*(X_Nor.col(0)).size(),-1)*((X_Nor*Theta_2-Y_Nor ).transpose()) *(X_Nor*Theta_2-Y_Nor);


J[k]=J_Th.sum();

Grad_J= 2*pow(2*(X_Nor.col(0)).size(),-1)*(X_Nor*Theta_2-Y_Nor).transpose() * X_Nor;

//Grad_J= 2*pow(2*(X_Nor.col(0)).size(),-1)*(X_Nor*Theta_2-Y_Nor).transpose() * X_Nor;
Theta_2=(1-Lr*apha*pow((X_Nor.col(0)).size(),-1))*Theta_2-Lr*Grad_J.transpose();
//Theta_2=Theta_2-Lr*Grad_J.transpose();

//-------------------------收斂條件:當下疊帶值與前一次疊帶值差值 eps<10^-8---------------------------//
	if(abs(J[k] -J[k-1]) <pow(10,-8) )
		{
            break;

        }

//-------------殘差平方和SSE(實際值Vs預測值)---------------//
  SSE=2*(X_Nor.col(0)).size()* MSE(0,0);//Σ(yi-y_hat_i)^2


//-------------總平方和SST(實際值Vs平均值)---------------//

MatrixXd SS_T(nn,1);

Y_Nor_avg=Y_Nor.sum()/Y_Nor.size();

for(int i=0;i<Y.col(0).size();++i){
for(int j=0;j<Y.row(0).size();++j){

SS_T(i,j)=pow((Y_Nor(i,j)-Y_Nor_avg),2);//Σ(yi-y_avg)^2

}
}
SST=SS_T.sum();




R_square=1- SSE/SST;

Y_R=X_Nor*Theta_2;

MatrixXd SS_R(nn,1);

//-------------總平方和SSR(實際結果Vs平均值)---------------//

for(int i=0;i<Y.col(0).size();++i){
for(int j=0;j<Y.row(0).size();++j){

SS_R(i,j)=pow((Y_R(i,j)-Y_Nor_avg),2);//Σ(y_hat_i-y_avg)^2


}
}

 SSR=SS_R.sum();
f=(SSR)/(SSE);

F=f*(nn-mm-1)/mm;


//-----------------------複相關分析-------------------------// 






oFile <<"epoch="<< k  << "  ,  " <<" MSE= "<< "  ,  "<<J[k] << "  ,  " << R_square<< endl;


}





for(int i=0;i<Y.col(0).size();++i){
for(int j=0;j<Y.row(0).size();++j){

Y_Inv_nor(i,j)=Y_R(i,j)*(Y.maxCoeff()-Y.minCoeff())+Y_avg(0,j);

}
}

for(int iii=0;iii<Y.col(0).size();++iii){
for(int jjj=0;jjj<Y.row(0).size();++jjj){

MAPE_ratio(iii,jjj)=(Y(iii,jjj)-Y_Inv_nor(iii,jjj))/Y(iii,jjj); 

}
}


MatrixXd COV1(nn,1);
MatrixXd COV2(nn,1);

PROD=(Y_Inv_nor).transpose()*Y;

PROD_Multi=PROD(0,0);



COV1=(Y_Inv_nor).array().square();
COV2=(Y).array().square();

S1=COV1.sum();
S2=COV2.sum();


Cossim=PROD_Multi/sqrt(S1*S2);


oFile <<Y_Inv_nor<<Y<<endl;

//cout<<endl;
//cout<<X<<endl;
//cout<<"X矩陣正規化"<<endl;
//cout<<endl;
//cout<<X_Nor<<endl;
//cout<<endl;
//cout<<" 房價 (Y)  "   <<endl;
//cout<<endl;
//cout<< Y <<endl;
//cout<<endl;
//cout<<"模擬後房價結果"<<endl;
//cout<<endl;
//cout<<Y_Inv_nor<<endl;
//cout<<endl;
cout<<"---------------------------------------------------"<<endl;
cout<<"|                     迴歸係數                     |"<<endl;
cout<<"---------------------------------------------------"<<endl;
cout<<endl;
for(int i=0;i<Theta_2.col(0).size();++i){
for(int j=0;j<Theta_2.row(0).size();++j){
cout<<"Beta_"<<i<<" = "<<Theta_2(i,j)<<endl;
cout<<endl;
}
}

cout<<"----------------------------------------------------"<<endl;
cout<<"|                 R平方值與擬合程度                 |"<<endl;
cout<<"----------------------------------------------------"<<endl;

cout<<"SSE="<<SSE<<endl;
cout<<endl;

cout<<"SST="<<SST<<endl;
cout<<endl;

cout<<"R_sqare=1-(SSE/SST)"<<endl;
cout<<endl;

cout<<"R_square="<<R_square<<endl;
cout<<endl;
if(R_square<0.5)

cout<<"欠擬合(underfitting)"<<endl;

else if (R_square>0.5&&R_square<0.9)

cout<<"擬合"<<endl;

else if (R_square>0.9)

cout<<"過擬合(overfitting)"<<endl;

cout<<"F-value"<<endl;

cout<<F<<endl;

cout<<"預測與實際準確度 "<<endl;  
cout<<Cossim<<endl;  

cout<<"MAPE值"<<endl; 

cout<< abs(MAPE_ratio.sum())/nn<<endl;           






}



